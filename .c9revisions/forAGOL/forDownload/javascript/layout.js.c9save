{"ts":1349799547083,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"  dojo.require(\"esri.map\");\n  dojo.require(\"esri.dijit.Legend\");\n  dojo.require(\"esri.dijit.Scalebar\");\n  dojo.require(\"esri.arcgis.utils\");\n  dojo.require(\"esri.IdentityManager\");\n  dojo.require(\"dijit.dijit\");\n  dojo.require(\"dijit.layout.BorderContainer\");\n  dojo.require(\"dijit.layout.ContentPane\");\n  dojo.require(\"dijit.layout.StackContainer\");\n  dojo.requireLocalization(\"esriTemplate\",\"template\");\n  \n  \n     var map, urlObjects, i18n;\n\t \n\t function initMap() {\n       patchID();\n\t   \n\t   //get the localization strings\n  \t   i18n = dojo.i18n.getLocalization(\"esriTemplate\",\"template\");\n\t  \n\t   dojo.byId('loading').innerHTML = i18n.viewer.loading.message;\n\t   dojo.byId('legTogText').innerHTML = i18n.viewer.legToggle.down;\n      \n       if(configOptions.geometryserviceurl && location.protocol === \"https:\"){\n         configOptions.geometryserviceurl = configOptions.geometryserviceurl.replace('http:','https:');\n       }\n       esri.config.defaults.geometryService = new esri.tasks.GeometryService(configOptions.geometryserviceurl);\n\n       if(!configOptions.sharingurl){\n         configOptions.sharingurl = location.protocol + '//' + location.host + \"/sharing/content/items\";\n       }\n       esri.arcgis.utils.arcgisUrl = configOptions.sharingurl;\n       \n       if(!configOptions.proxyurl){   \n         configOptions.proxyurl = location.protocol + '//' + location.host + \"/sharing/proxy\";\n       }\n\n       esri.config.defaults.io.proxyUrl =  configOptions.proxyurl;\n\n       esri.config.defaults.io.alwaysUseProxy = false;\n      \n       urlObject = esri.urlToObject(document.location.href);\n       urlObject.query = urlObject.query || {};\n      \n       if(urlObject.query.title){\n         configOptions.title = urlObject.query.title;\n       }\n       if(urlObject.query.subtitle){\n         configOptions.title = urlObject.query.subtitle;\n       }\n       if(urlObject.query.webmap){\n         configOptions.webmap = urlObject.query.webmap;      \n       } \n       if(urlObject.query.bingMapsKey){\n         configOptions.bingmapskey = urlObject.query.bingMapsKey;      \n       }\n\n\t   esri.arcgis.utils.arcgisUrl = \"http://arcgis.com/sharing/content/items\";\t\n\t\t\n\t   var mapDeferred = esri.arcgis.utils.createMap(configOptions.webmap, \"map\", {\n         mapOptions: {\n           slider: true,\n           nav: false,\n           wrapAround180:true\n         },\n         ignorePopups:false,\n         bingMapsKey: configOptions.bingmapskey\n       });\n\n       mapDeferred.addCallback(function (response) {\n        \n\t\t document.title = configOptions.title|| response.itemInfo.item.title || \"\";\n         dojo.byId(\"title\").innerHTML = configOptions.title ||response.itemInfo.item.title || \"\";\n         dojo.byId(\"subtitle\").innerHTML = configOptions.subtitle|| response.itemInfo.item.snippet || \"\";\n        \n         map = response.map;\n\t\t\n\t\t dojo.connect(map,\"onUpdateEnd\",hideLoader);\n\t\t\n         var layers = response.itemInfo.itemData.operationalLayers;\n         if(map.loaded){\n           initUI(layers);\n         }\n         else{\n           dojo.connect(map,\"onLoad\",function(){\n             initUI(layers);\n           });\n         }\n         //resize the map when the browser resizes\n         dojo.connect(dijit.byId('map'), 'resize', map,map.resize);\n       });\n\n       mapDeferred.addErrback(function (error) {\n         alert(i18n.viewer.errors.createMap + dojo.toJson(error.message));\n       });\n\t   \n     }\n\n\n     function initUI(layers) {\n       //add chrome theme for popup\n       dojo.addClass(map.infoWindow.domNode, \"chrome\");\n       //add the scalebar \n       var scalebar = new esri.dijit.Scalebar({\n         map: map,\n         scalebarUnit:i18n.viewer.main.scaleBarUnits //metric or english\n       }); \n\n       var layerInfo = buildLayersList(layers);\n      \n       if(layerInfo.length > 0){\n         var legendDijit = new esri.dijit.Legend({\n           map:map,\n           layerInfos:layerInfo\n         },\"legendDiv\");\n         legendDijit.startup();\n       }\n       else{\n         dojo.byId('legendDiv').innerHTML = \"\";\n       }\n     }\n\t \nfunction buildLayersList(layers){\n        //layers  arg is  response.itemInfo.itemData.operationalLayers;\n        var layerInfos = [];\n        dojo.forEach(layers, function(mapLayer, index){\n          var layerInfo = {};\n          if (mapLayer.featureCollection && mapLayer.type !== \"CSV\") {\n            if (mapLayer.featureCollection.showLegend === true) {\n              dojo.forEach(mapLayer.featureCollection.layers, function(fcMapLayer){\n                if (fcMapLayer.showLegend !== false) {\n                  layerInfo = {\n                    \"layer\": fcMapLayer.layerObject,\n                    \"title\": mapLayer.title,\n                    \"defaultSymbol\": false\n                  };\n                  if (mapLayer.featureCollection.layers.length > 1) {\n                    layerInfo.title += \" - \" + fcMapLayer.layerDefinition.name;\n                  }\n                  layerInfos.push(layerInfo);\n                }\n              });\n            }\n          } else if (mapLayer.showLegend !== false) {\n            layerInfo = {\n              \"layer\": mapLayer.layerObject,\n              \"title\": mapLayer.title,\n              \"defaultSymbol\": false\n            };\n            //does it have layers too? If so check to see if showLegend is false\n            if (mapLayer.layers) {\n              var hideLayers = dojo.map(dojo.filter(mapLayer.layers, function(lyr){\n                return (lyr.showLegend === false);\n              }), function(lyr){\n                return lyr.id\n              });\n              if (hideLayers.length) {\n                layerInfo.hideLayers = hideLayers;\n              }\n            }\n            layerInfos.push(layerInfo);\n          }\n        });\n        return layerInfos;\n      }\n\n    \n     function patchID() {  //patch id manager for use in apps.arcgis.com\n       esri.id._isIdProvider = function(server, resource) {\n       // server and resource are assumed one of portal domains\n \n       var i = -1, j = -1;\n \n       dojo.forEach(this._gwDomains, function(domain, idx) {\n         if (i === -1 && domain.regex.test(server)) {\n           i = idx;\n         }\n         if (j === -1 && domain.regex.test(resource)) {\n           j = idx;\n         }\n       });\n \n       var retVal = false;\n   \n       if (i > -1 && j > -1) {\n         if (i === 0 || i === 4) {\n           if (j === 0 || j === 4) {\n             retVal = true;\n           }\n         }\n         else if (i === 1) {\n           if (j === 1 || j === 2) {\n             retVal = true;\n           }\n         }\n         else if (i === 2) {\n           if (j === 2) {\n             retVal = true;\n           }\n         }\n         else if (i === 3) {\n           if (j === 3) {\n             retVal = true;\n           }\n         }\n       }\n \n       return retVal;\n     };    \n    }\n\t\n\tfunction hideLoader(){\n\t  $(\"#loadingCon\").hide();\n\t}\n\t\n\t//Jquery Layout\n\t$(document).ready(function(e) {\n\t  $(\"#legendToggle\").click(function(){\n\t\tif ($(\"#legendDiv\").css('display')=='none'){\n\t\t  $(\"#legTogText\").html(i18n.viewer.legToggle.up);\n\t\t}\n\t\telse{\n\t\t  $(\"#legTogText\").html(i18n.viewer.legToggle.down);\n\t\t}\n\t\t$(\"#legendDiv\").slideToggle();\n\t  });\n    });"]],"start1":0,"start2":0,"length1":0,"length2":7196}]],"length":7196}
{"contributors":[],"silentsave":true,"ts":1349800548763,"patch":[[{"diffs":[[0,"   }\n\t \n"],[1,"//build a list of layers to dispaly in the legend\n  "],[0,"function"]],"start1":4048,"start2":4048,"length1":16,"length2":68},{"diffs":[[0,"ayers){\n"],[-1,"       "],[1,"\n"],[0," //layer"]],"start1":4134,"start2":4134,"length1":23,"length2":17},{"diffs":[[0,"Layers;\n"],[-1,"      "],[0,"  var la"]],"start1":4200,"start2":4200,"length1":22,"length2":16},{"diffs":[[0,"s = [];\n"],[-1,"      "],[0,"  dojo.f"]],"start1":4223,"start2":4223,"length1":22,"length2":16},{"diffs":[[0,"function"],[1," "],[0,"(mapLaye"]],"start1":4254,"start2":4254,"length1":16,"length2":17},{"diffs":[[0,", index)"],[1," "],[0,"{\n"],[-1,"    "],[0,"      va"]],"start1":4272,"start2":4272,"length1":22,"length2":19},{"diffs":[[0,"= {};\n      "],[-1,"    "],[0,"if (mapLayer"]],"start1":4303,"start2":4303,"length1":28,"length2":24},{"diffs":[[0,"== \"CSV\") {\n"],[-1,"    "],[0,"        if ("]],"start1":4364,"start2":4364,"length1":28,"length2":24},{"diffs":[[0,"            "],[-1,"  "],[0,"dojo.forEach"]],"start1":4438,"start2":4438,"length1":26,"length2":24},{"diffs":[[0,"function"],[1," "],[0,"(fcMapLa"]],"start1":4498,"start2":4498,"length1":16,"length2":17},{"diffs":[[0,"apLayer)"],[1," "],[0,"{\n"],[-1,"  "],[0,"        "]],"start1":4511,"start2":4511,"length1":20,"length2":19},{"diffs":[[0,"                "],[1," "],[1," "],[0,"\"layer\": fcMapLa"]],"start1":4611,"start2":4611,"length1":32,"length2":34},{"diffs":[[0,"                "],[1,"  "],[0,"\"title\": mapLaye"]],"start1":4666,"start2":4666,"length1":32,"length2":34},{"diffs":[[0,"                "],[1," "],[1," "],[0,"\"defaultSymbol\":"]],"start1":4713,"start2":4713,"length1":32,"length2":34},{"diffs":[[0,"ngth > 1) {\n"],[1,"  "],[0,"            "]],"start1":4833,"start2":4833,"length1":24,"length2":26},{"diffs":[[0,";\n              "],[-1," "],[-1," "],[0,"}\n"],[-1,"  "],[0,"            });\n"]],"start1":4991,"start2":4991,"length1":38,"length2":34},{"diffs":[[0,"        "],[-1,"  }\n  "],[1,"}\n"],[0,"      "],[-1,"  "],[0,"} else i"]],"start1":5027,"start2":5027,"length1":30,"length2":24},{"diffs":[[0,"alse"],[-1,") {\n            layerInfo = {"],[1," && mapLayer.layerObject) {\n      var showDefaultSymbol = false;\n      if (mapLayer.layerObject.version < 10.1 && (mapLayer.layerObject instanceof esri.layers.ArcGISDynamicMapServiceLayer || mapLayer.layerObject instanceof esri.layers.ArcGISTiledMapServiceLayer)) {\n        showDefaultSymbol = true;"],[0,"\n     "],[1," }\n"],[0," "],[1,"     layerInfo = {\n"],[0,"    "]],"start1":5079,"start2":5079,"length1":44,"length2":336},{"diffs":[[0,"Object,\n        "],[-1,"      "],[0,"\"title\": mapLaye"]],"start1":5442,"start2":5442,"length1":38,"length2":32},{"diffs":[[0,".title,\n        "],[-1,"     "],[-1," "],[0,"\"defaultSymbol\":"]],"start1":5475,"start2":5475,"length1":38,"length2":32},{"diffs":[[0,"l\": "],[-1,"false\n    "],[1,"showDefaultSymbol\n"],[0,"      "],[-1,"  "],[0,"};\n"],[-1,"    "],[0,"    "]],"start1":5504,"start2":5504,"length1":33,"length2":35},{"diffs":[[0,"nd is false\n"],[-1,"    "],[0,"        if ("]],"start1":5600,"start2":5600,"length1":28,"length2":24},{"diffs":[[0,"            "],[-1,"  "],[0,"var hideLaye"]],"start1":5643,"start2":5643,"length1":26,"length2":24},{"diffs":[[0,"layers, function"],[1," "],[0,"(lyr)"],[1," "],[0,"{\n              "]],"start1":5702,"start2":5702,"length1":37,"length2":39},{"diffs":[[0,"        "],[-1,"  "],[0,"}), func"]],"start1":5782,"start2":5782,"length1":18,"length2":16},{"diffs":[[0,"function"],[1," "],[0,"(lyr)"],[1," "],[0,"{\n      "]],"start1":5794,"start2":5794,"length1":21,"length2":23},{"diffs":[[0,"n lyr.id"],[1,";"],[0,"\n"],[-1,"  "],[0,"        "]],"start1":5832,"start2":5832,"length1":19,"length2":18},{"diffs":[[0,"            });\n"],[-1,"  "],[0,"            if ("]],"start1":5842,"start2":5842,"length1":34,"length2":32},{"diffs":[[0,"hideLayers;\n"],[-1,"  "],[0,"            "]],"start1":5934,"start2":5934,"length1":26,"length2":24},{"diffs":[[0,"  }\n        "],[-1,"    }\n    "],[1,"}\n"],[0,"        laye"]],"start1":5956,"start2":5956,"length1":34,"length2":26},{"diffs":[[0,"    "],[-1,"      }\n        });\n      "],[1,"}\n  });\n"],[0,"  re"]],"start1":6006,"start2":6006,"length1":34,"length2":16},{"diffs":[[0,"rInfos;\n"],[-1,"    "],[0,"  }\n\n   "]],"start1":6031,"start2":6031,"length1":20,"length2":16}]],"length":7459,"saved":false}
{"ts":1349800555734,"patch":[[{"diffs":[[0,"late\");\n"],[-1,"  \n  "],[1,"\n"],[0,"\n     va"]],"start1":398,"start2":398,"length1":21,"length2":17},{"diffs":[[0,", i18n;\n"],[-1,"\t "],[0,""],[1,""],[0,"\n\t funct"]],"start1":432,"start2":432,"length1":18,"length2":16},{"diffs":[[0,"chID();\n"],[-1,"\t   "],[0,""],[1,""],[0,"\n\t   //g"]],"start1":474,"start2":474,"length1":20,"length2":16},{"diffs":[[0,"late\");\n"],[-1,"\t  "],[0,""],[1,""],[0,"\n\t   doj"]],"start1":577,"start2":577,"length1":19,"length2":16},{"diffs":[[0,"e.down;\n"],[-1,"      "],[0,""],[1,""],[0,"\n       "]],"start1":712,"start2":712,"length1":22,"length2":16},{"diffs":[[0,"ingurl;\n"],[-1,"       "],[0,"\n       "]],"start1":1233,"start2":1233,"length1":23,"length2":16},{"diffs":[[0,"oxyurl){"],[-1,"   "],[0,"\n       "]],"start1":1269,"start2":1269,"length1":19,"length2":16},{"diffs":[[0," false;\n"],[-1,"      "],[0,""],[1,""],[0,"\n       "]],"start1":1498,"start2":1498,"length1":22,"length2":16},{"diffs":[[0," || {};\n"],[-1,"      "],[0,""],[1,""],[0,"\n       "]],"start1":1608,"start2":1608,"length1":22,"length2":16},{"diffs":[[0,".webmap;"],[-1,"      "],[0,"\n       "]],"start1":1899,"start2":1899,"length1":22,"length2":16},{"diffs":[[0,"       }"],[-1," "],[0,"\n       "]],"start1":1908,"start2":1908,"length1":17,"length2":16},{"diffs":[[0,"MapsKey;"],[-1,"      "],[0,"\n       "]],"start1":2014,"start2":2014,"length1":22,"length2":16},{"diffs":[[0,"/items\";"],[-1,"\t\n\t\t"],[1,"\n"],[0,"\n\t   var"]],"start1":2101,"start2":2101,"length1":20,"length2":17},{"diffs":[[0,"onse) {\n"],[-1,"        "],[0,""],[1,""],[0,"\n\t\t docu"]],"start1":2439,"start2":2439,"length1":24,"length2":16},{"diffs":[[0," || \"\";\n"],[-1,"        "],[0,""],[1,""],[0,"\n       "]],"start1":2722,"start2":2722,"length1":24,"length2":16},{"diffs":[[0,"se.map;\n"],[-1,"\t\t"],[0,""],[1,""],[0,"\n\t\t dojo"]],"start1":2752,"start2":2752,"length1":18,"length2":16},{"diffs":[[0,"oader);\n"],[-1,"\t\t"],[0,""],[1,""],[0,"\n       "]],"start1":2800,"start2":2800,"length1":18,"length2":16},{"diffs":[[0,"    });\n"],[-1,"\t   "],[0,""],[1,""],[0,"\n     }\n"]],"start1":3317,"start2":3317,"length1":20,"length2":16},{"diffs":[[0,"scalebar"],[-1," "],[0,""],[1,""],[0,"\n       "]],"start1":3475,"start2":3475,"length1":17,"length2":16},{"diffs":[[0,"     });"],[-1," "],[0,""],[1,""],[0,"\n\n      "]],"start1":3626,"start2":3626,"length1":17,"length2":16},{"diffs":[[0,"ayers);\n"],[-1,"      "],[0,""],[1,""],[0,"\n       "]],"start1":3676,"start2":3676,"length1":22,"length2":16},{"diffs":[[0,"\n     }\n"],[-1,"\t "],[0,""],[1,""],[0,"\n//build"]],"start1":3956,"start2":3956,"length1":18,"length2":16},{"diffs":[[0,"s;\n  }\n\n"],[-1,"    "],[0,""],[1,""],[0,"\n     fu"]],"start1":5945,"start2":5945,"length1":20,"length2":16},{"diffs":[[0,"domains\n"],[-1," "],[0,""],[1,""],[0,"\n       "]],"start1":6143,"start2":6143,"length1":17,"length2":16},{"diffs":[[0,"j = -1;\n"],[-1," "],[0,""],[1,""],[0,"\n       "]],"start1":6171,"start2":6171,"length1":17,"length2":16},{"diffs":[[0,"    });\n"],[-1," "],[0,""],[1,""],[0,"\n       "]],"start1":6416,"start2":6416,"length1":17,"length2":16},{"diffs":[[0," false;\n"],[-1,"   "],[0,""],[1,""],[0,"\n       "]],"start1":6444,"start2":6444,"length1":19,"length2":16},{"diffs":[[0,"      }\n"],[-1," "],[0,""],[1,""],[0,"\n       "]],"start1":6941,"start2":6941,"length1":17,"length2":16},{"diffs":[[0,"  };"],[-1,"    "],[0,""],[1,""],[0,"\n    }\n"],[-1,"\t"],[0,""],[1,""],[0,"\n\tfu"]],"start1":6975,"start2":6975,"length1":20,"length2":15},{"diffs":[[0,"e();\n\t}\n"],[-1,"\t"],[0,"\n\t//Jque"]],"start1":7034,"start2":7034,"length1":17,"length2":16}]],"length":7351,"saved":false}
{"contributors":[],"silentsave":false,"ts":1350321915396,"patch":[[{"diffs":[[0," }\n\n"],[-1,"\t   esri.arcgis.utils.arcgisUrl = \"http://arcgis.com/sharing/content/items\";\n\n"],[0,"\t   "]],"start1":2029,"start2":2029,"length1":86,"length2":8}]],"length":7273,"saved":false}
{"contributors":[],"silentsave":true,"ts":1351541314967,"patch":[[{"diffs":[[1,"  dojo.require(\"esri.map\");\n  dojo.require(\"esri.dijit.Legend\");\n  dojo.require(\"esri.dijit.Scalebar\");\n  dojo.require(\"esri.arcgis.utils\");\n  dojo.require(\"esri.IdentityManager\");\n  dojo.require(\"dijit.dijit\");\n  dojo.require(\"dijit.layout.BorderContainer\");\n  dojo.require(\"dijit.layout.ContentPane\");\n  dojo.require(\"dijit.layout.StackContainer\");\n  dojo.requireLocalization(\"esriTemplate\",\"template\");\n\n\n     var map, urlObjects, i18n;\n\n\t function initMap() {\n       patchID();\n\n\t   //get the localization strings\n  \t   i18n = dojo.i18n.getLocalization(\"esriTemplate\",\"template\");\n\n\t   dojo.byId('loading').innerHTML = i18n.viewer.loading.message;\n\t   dojo.byId('legTogText').innerHTML = i18n.viewer.legToggle.down;\n\n       if(configOptions.geometryserviceurl && location.protocol === \"https:\"){\n         configOptions.geometryserviceurl = configOptions.geometryserviceurl.replace('http:','https:');\n       }\n       esri.config.defaults.geometryService = new esri.tasks.GeometryService(configOptions.geometryserviceurl);\n\n       if(!configOptions.sharingurl){\n         configOptions.sharingurl = location.protocol + '//' + location.host + \"/sharing/content/items\";\n       }\n       esri.arcgis.utils.arcgisUrl = configOptions.sharingurl;\n\n       if(!configOptions.proxyurl){\n         configOptions.proxyurl = location.protocol + '//' + location.host + \"/sharing/proxy\";\n       }\n\n       esri.config.defaults.io.proxyUrl =  configOptions.proxyurl;\n\n       esri.config.defaults.io.alwaysUseProxy = false;\n\n       urlObject = esri.urlToObject(document.location.href);\n       urlObject.query = urlObject.query || {};\n\n       if(urlObject.query.title){\n         configOptions.title = urlObject.query.title;\n       }\n       if(urlObject.query.subtitle){\n         configOptions.title = urlObject.query.subtitle;\n       }\n       if(urlObject.query.webmap){\n         configOptions.webmap = urlObject.query.webmap;\n       }\n       if(urlObject.query.bingMapsKey){\n         configOptions.bingmapskey = urlObject.query.bingMapsKey;\n       }\n\n\t   var mapDeferred = esri.arcgis.utils.createMap(configOptions.webmap, \"map\", {\n         mapOptions: {\n           slider: true,\n           nav: false,\n           wrapAround180:true\n         },\n         ignorePopups:false,\n         bingMapsKey: configOptions.bingmapskey\n       });\n\n       mapDeferred.addCallback(function (response) {\n\n\t\t document.title = configOptions.title|| response.itemInfo.item.title || \"\";\n         dojo.byId(\"title\").innerHTML = configOptions.title ||response.itemInfo.item.title || \"\";\n         dojo.byId(\"subtitle\").innerHTML = configOptions.subtitle|| response.itemInfo.item.snippet || \"\";\n\n         map = response.map;\n\n\t\t dojo.connect(map,\"onUpdateEnd\",hideLoader);\n\n         var layers = response.itemInfo.itemData.operationalLayers;\n         if(map.loaded){\n           initUI(layers);\n         }\n         else{\n           dojo.connect(map,\"onLoad\",function(){\n             initUI(layers);\n           });\n         }\n         //resize the map when the browser resizes\n         dojo.connect(dijit.byId('map'), 'resize', map,map.resize);\n       });\n\n       mapDeferred.addErrback(function (error) {\n         alert(i18n.viewer.errors.createMap + dojo.toJson(error.message));\n       });\n\n     }\n\n\n     function initUI(layers) {\n       //add chrome theme for popup\n       dojo.addClass(map.infoWindow.domNode, \"chrome\");\n       //add the scalebar\n       var scalebar = new esri.dijit.Scalebar({\n         map: map,\n         scalebarUnit:i18n.viewer.main.scaleBarUnits //metric or english\n       });\n       \n\n       var layerInfo = buildLayersList(layers);\n\n       if(layerInfo.length > 0){\n         var legendDijit = new esri.dijit.Legend({\n           map:map,\n           layerInfos:layerInfo\n         },\"legendDiv\");\n         legendDijit.startup();\n       }\n       else{\n         dojo.byId('legendDiv').innerHTML = \"\";\n       }\n     }\n\n//build a list of layers to dispaly in the legend\n  function buildLayersList(layers){\n\n //layers  arg is  response.itemInfo.itemData.operationalLayers;\n  var layerInfos = [];\n  dojo.forEach(layers, function (mapLayer, index) {\n      var layerInfo = {};\n      if (mapLayer.featureCollection && mapLayer.type !== \"CSV\") {\n        if (mapLayer.featureCollection.showLegend === true) {\n            dojo.forEach(mapLayer.featureCollection.layers, function (fcMapLayer) {\n              if (fcMapLayer.showLegend !== false) {\n                  layerInfo = {\n                      \"layer\": fcMapLayer.layerObject,\n                      \"title\": mapLayer.title,\n                      \"defaultSymbol\": false\n                  };\n                  if (mapLayer.featureCollection.layers.length > 1) {\n                      layerInfo.title += \" - \" + fcMapLayer.layerDefinition.name;\n                  }\n                  layerInfos.push(layerInfo);\n              }\n            });\n          }\n      } else if (mapLayer.showLegend !== false && mapLayer.layerObject) {\n      var showDefaultSymbol = false;\n      if (mapLayer.layerObject.version < 10.1 && (mapLayer.layerObject instanceof esri.layers.ArcGISDynamicMapServiceLayer || mapLayer.layerObject instanceof esri.layers.ArcGISTiledMapServiceLayer)) {\n        showDefaultSymbol = true;\n      }\n      layerInfo = {\n        \"layer\": mapLayer.layerObject,\n        \"title\": mapLayer.title,\n        \"defaultSymbol\": showDefaultSymbol\n      };\n        //does it have layers too? If so check to see if showLegend is false\n        if (mapLayer.layers) {\n            var hideLayers = dojo.map(dojo.filter(mapLayer.layers, function (lyr) {\n                return (lyr.showLegend === false);\n            }), function (lyr) {\n                return lyr.id;\n            });\n            if (hideLayers.length) {\n                layerInfo.hideLayers = hideLayers;\n            }\n        }\n        layerInfos.push(layerInfo);\n    }\n  });\n  return layerInfos;\n  }\n\n\n     function patchID() {  //patch id manager for use in apps.arcgis.com\n       esri.id._isIdProvider = function(server, resource) {\n       // server and resource are assumed one of portal domains\n\n       var i = -1, j = -1;\n\n       dojo.forEach(this._gwDomains, function(domain, idx) {\n         if (i === -1 && domain.regex.test(server)) {\n           i = idx;\n         }\n         if (j === -1 && domain.regex.test(resource)) {\n           j = idx;\n         }\n       });\n\n       var retVal = false;\n\n       if (i > -1 && j > -1) {\n         if (i === 0 || i === 4) {\n           if (j === 0 || j === 4) {\n             retVal = true;\n           }\n         }\n         else if (i === 1) {\n           if (j === 1 || j === 2) {\n             retVal = true;\n           }\n         }\n         else if (i === 2) {\n           if (j === 2) {\n             retVal = true;\n           }\n         }\n         else if (i === 3) {\n           if (j === 3) {\n             retVal = true;\n           }\n         }\n       }\n\n       return retVal;\n     };\n    }\n\n\tfunction hideLoader(){\n\t  $(\"#loadingCon\").hide();\n\t}\n\n\t//Jquery Layout\n\t$(document).ready(function(e) {\n\t  $(\"#legendToggle\").click(function(){\n\t\tif ($(\"#legendDiv\").css('display')=='none'){\n\t\t  $(\"#legTogText\").html(i18n.viewer.legToggle.up);\n\t\t}\n\t\telse{\n\t\t  $(\"#legTogText\").html(i18n.viewer.legToggle.down);\n\t\t}\n\t\t$(\"#legendDiv\").slideToggle();\n\t  });\n    });"]],"start1":0,"start2":0,"length1":0,"length2":7281}]],"length":7281,"saved":false}
{"contributors":[],"silentsave":true,"ts":1351541391725,"patch":[[{"diffs":[[0,"apsKey;\n"],[1,"         \n"],[0,"       }"]],"start1":2015,"start2":2015,"length1":16,"length2":26}]],"length":7291,"saved":false}
{"ts":1351541393309,"patch":[[{"diffs":[[0,"ey;\n"],[-1,"         \n"],[0,"    "]],"start1":2019,"start2":2019,"length1":18,"length2":8}]],"length":7281,"saved":false}
{"ts":1351541395354,"patch":[[{"diffs":[[0,"       }"],[1,"\n       \n       if (configOptions.legend == false){\n    \t   $(\"#legendToggle\").hide();\n\t   }"],[0,"\n\n\t   va"]],"start1":2023,"start2":2023,"length1":16,"length2":108}]],"length":7373,"saved":false}
{"ts":1351541421354,"patch":[[{"diffs":[[0,"    "],[-1,"dojo.byId('legendDiv').innerHTML = \"\""],[1,"$(\"#legendToggle\").hide()"],[0,";\n  "]],"start1":3927,"start2":3927,"length1":45,"length2":33}]],"length":7361,"saved":false}
{"ts":1351541520097,"patch":[[{"diffs":[[0,"gend == "],[1,"\""],[0,"false){\n"]],"start1":2067,"start2":2067,"length1":16,"length2":17}]],"length":7362,"saved":false}
{"ts":1351541522336,"patch":[[{"diffs":[[0,"= \"false"],[1,"\""],[0,"){\n    \t"]],"start1":2073,"start2":2073,"length1":16,"length2":17}]],"length":7363,"saved":false}
{"ts":1351541523271,"patch":[[{"diffs":[[0,"      }\n"],[-1,"       "],[0,"\n       "]],"start1":2024,"start2":2024,"length1":23,"length2":16},{"diffs":[[0,"    });\n"],[-1,"       "],[0,"\n\n      "]],"start1":3636,"start2":3636,"length1":23,"length2":16}]],"length":7349,"saved":false}
{"ts":1351541536040,"patch":[[{"diffs":[[0,"psKey;\n       }\n"],[1,"       "],[0,"\n       if (conf"]],"start1":2016,"start2":2016,"length1":32,"length2":39},{"diffs":[[0,"    });\n"],[1,"       "],[0,"\n\n      "]],"start1":3643,"start2":3643,"length1":16,"length2":23}]],"length":7363,"saved":false}
{"ts":1351541537834,"patch":[[{"diffs":[[0,"      }\n"],[-1,"       "],[0,"\n       "]],"start1":2024,"start2":2024,"length1":23,"length2":16},{"diffs":[[0,"    });\n"],[-1,"       "],[0,"\n\n      "]],"start1":3636,"start2":3636,"length1":23,"length2":16}]],"length":7349,"saved":false}
{"ts":1351541543406,"patch":[[{"diffs":[[0,"psKey;\n       }\n"],[1,"       "],[0,"\n       if (conf"]],"start1":2016,"start2":2016,"length1":32,"length2":39},{"diffs":[[0,"= \"false"],[-1,"\""],[0,"){\n    \t"]],"start1":2073,"start2":2073,"length1":17,"length2":16},{"diffs":[[0,"    });\n"],[1,"       "],[0,"\n\n      "]],"start1":3642,"start2":3642,"length1":16,"length2":23}]],"length":7362,"saved":false}
{"ts":1351541545610,"patch":[[{"diffs":[[0,"gend == "],[-1,"\""],[0,"false){\n"]],"start1":2067,"start2":2067,"length1":17,"length2":16},{"diffs":[[0,"    "],[-1,"$(\"#legendToggle\").hide()"],[1,"dojo.byId('legendDiv').innerHTML = \"\""],[0,";\n  "]],"start1":3927,"start2":3927,"length1":33,"length2":45}]],"length":7373,"saved":false}
{"ts":1351541546911,"patch":[[{"diffs":[[0,"    "],[-1,"dojo.byId('legendDiv').innerHTML = \"\""],[1,"$(\"#legendToggle\").hide()"],[0,";\n  "]],"start1":3927,"start2":3927,"length1":45,"length2":33}]],"length":7361,"saved":false}
{"ts":1351541547373,"patch":[[{"diffs":[[0,"      }\n"],[-1,"       "],[0,"\n       "]],"start1":2024,"start2":2024,"length1":23,"length2":16},{"diffs":[[0,"    });\n"],[-1,"       "],[0,"\n\n      "]],"start1":3634,"start2":3634,"length1":23,"length2":16}]],"length":7347,"saved":false}
{"ts":1351541603672,"patch":[[{"diffs":[[0,"    if ("],[1,"getL"],[0,"configOp"]],"start1":2036,"start2":2036,"length1":16,"length2":20}]],"length":7351,"saved":false}
{"ts":1351541604555,"patch":[[{"diffs":[[0,"if (getL"],[1,"e"],[0,"configOp"]],"start1":2040,"start2":2040,"length1":16,"length2":17}]],"length":7352,"saved":false}
{"ts":1351541605645,"patch":[[{"diffs":[[0,"f (getLe"],[1,"g"],[0,"configOp"]],"start1":2041,"start2":2041,"length1":16,"length2":17}]],"length":7353,"saved":false}
{"ts":1351541607321,"patch":[[{"diffs":[[0," (getLeg"],[1,"end"],[0,"configOp"]],"start1":2042,"start2":2042,"length1":16,"length2":19}]],"length":7356,"saved":false}
{"ts":1351541609728,"patch":[[{"diffs":[[0,"etLegend"],[1,"Return"],[0,"configOp"]],"start1":2045,"start2":2045,"length1":16,"length2":22}]],"length":7362,"saved":false}
{"ts":1351541611797,"patch":[[{"diffs":[[0,"ndReturn"],[1,"("],[0,"configOp"]],"start1":2051,"start2":2051,"length1":16,"length2":17}]],"length":7363,"saved":false}
{"ts":1351541614540,"patch":[[{"diffs":[[0,"s.legend"],[1,")"],[0," == fals"]],"start1":2072,"start2":2072,"length1":16,"length2":17}]],"length":7364,"saved":false}
{"ts":1351541628462,"patch":[[{"diffs":[[0,"gend"],[-1,"Return"],[0,"(con"]],"start1":2049,"start2":2049,"length1":14,"length2":8}]],"length":7358,"saved":false}
{"ts":1351541630279,"patch":[[{"diffs":[[0,"etLegend"],[1,"Config"],[0,"(configO"]],"start1":2045,"start2":2045,"length1":16,"length2":22}]],"length":7364,"saved":false}
{"ts":1351541649167,"patch":[[{"diffs":[[0," });\n    });"],[1,"\n    \n    "]],"start1":7352,"start2":7352,"length1":12,"length2":22}]],"length":7374,"saved":false}
{"ts":1351541650307,"patch":[[{"diffs":[[0,");\n    \n    "],[1,"ger"]],"start1":7362,"start2":7362,"length1":12,"length2":15}]],"length":7377,"saved":false}
{"ts":1351541651372,"patch":[[{"diffs":[[0," \n    ge"],[-1,"r"],[1,"t "]],"start1":7368,"start2":7368,"length1":9,"length2":10}]],"length":7378,"saved":false}
{"ts":1351541652789,"patch":[[{"diffs":[[0,"  \n    g"],[-1,"et "]],"start1":7367,"start2":7367,"length1":11,"length2":8}]],"length":7375,"saved":false}
{"ts":1351541654161,"patch":[[{"diffs":[[0,"  \n    g"],[1,"etLegendConfig"]],"start1":7367,"start2":7367,"length1":8,"length2":22}]],"length":7389,"saved":false}
{"ts":1351541655823,"patch":[[{"diffs":[[0,"\n    getLegendConfig"],[1,"(str"]],"start1":7369,"start2":7369,"length1":20,"length2":24}]],"length":7393,"saved":false}
{"ts":1351541656927,"patch":[[{"diffs":[[0,"nfig(str"],[1,")"]],"start1":7385,"start2":7385,"length1":8,"length2":9}]],"length":7394,"saved":false}
{"ts":1351541657780,"patch":[[{"diffs":[[0,"fig(str)"],[1,"{"]],"start1":7386,"start2":7386,"length1":8,"length2":9}]],"length":7395,"saved":false}
{"ts":1351541659251,"patch":[[{"diffs":[[0,"ig(str){"],[1,"\n        "]],"start1":7387,"start2":7387,"length1":8,"length2":17}]],"length":7404,"saved":false}
{"ts":1351541661018,"patch":[[{"diffs":[[0,"g(str){\n    "],[-1,"    "],[1,"}"]],"start1":7388,"start2":7388,"length1":16,"length2":13}]],"length":7401,"saved":false}
{"ts":1351541662825,"patch":[[{"diffs":[[0,"g(str){\n"],[1,"        \n"],[0,"    }"]],"start1":7388,"start2":7388,"length1":13,"length2":22}]],"length":7410,"saved":false}
{"ts":1351541665707,"patch":[[{"diffs":[[0,"r){\n        "],[1,"if"],[0,"\n    }"]],"start1":7392,"start2":7392,"length1":18,"length2":20}]],"length":7412,"saved":false}
{"ts":1351541667825,"patch":[[{"diffs":[[0,"      if"],[1,"("],[0,"\n    }"]],"start1":7398,"start2":7398,"length1":14,"length2":15}]],"length":7413,"saved":false}
{"ts":1351541668639,"patch":[[{"diffs":[[0,"      if"],[-1,"("],[1," "],[0,"\n    }"]],"start1":7398,"start2":7398,"length1":15,"length2":15}]],"length":7413,"saved":false}
{"ts":1351541669660,"patch":[[{"diffs":[[0,"     if "],[1,"(s"],[0,"\n    }"]],"start1":7399,"start2":7399,"length1":14,"length2":16}]],"length":7415,"saved":false}
{"ts":1351541671823,"patch":[[{"diffs":[[0,"   if (s"],[1,"t"],[0,"\n    }"]],"start1":7401,"start2":7401,"length1":14,"length2":15}]],"length":7416,"saved":false}
{"ts":1351541673340,"patch":[[{"diffs":[[0,"  if (st"],[1,"r"],[0,"\n    }"]],"start1":7402,"start2":7402,"length1":14,"length2":15}]],"length":7417,"saved":false}
{"ts":1351541673949,"patch":[[{"diffs":[[0," if (str"],[1,"."],[0,"\n    }"]],"start1":7403,"start2":7403,"length1":14,"length2":15}]],"length":7418,"saved":false}
{"ts":1351541674932,"patch":[[{"diffs":[[0,"if (str."],[1,"low"],[0,"\n    }"]],"start1":7404,"start2":7404,"length1":14,"length2":17}]],"length":7421,"saved":false}
{"ts":1351541675816,"patch":[[{"diffs":[[0,"(str.low"],[1,"e"],[0,"\n    }"]],"start1":7407,"start2":7407,"length1":14,"length2":15}]],"length":7422,"saved":false}
{"ts":1351541677692,"patch":[[{"diffs":[[0,"str."],[-1,"lowe"],[1,"to"],[0,"\n   "]],"start1":7408,"start2":7408,"length1":12,"length2":10}]],"length":7420,"saved":false}
{"ts":1351541680380,"patch":[[{"diffs":[[0," (str.to"],[1,"Lo"],[0,"\n    }"]],"start1":7406,"start2":7406,"length1":14,"length2":16}]],"length":7422,"saved":false}
{"ts":1351541681433,"patch":[[{"diffs":[[0,"str.toLo"],[1,"werC"],[0,"\n    }"]],"start1":7408,"start2":7408,"length1":14,"length2":18}]],"length":7426,"saved":false}
{"ts":1351541682728,"patch":[[{"diffs":[[0,"toLowerC"],[1,"ase"],[0,"\n    }"]],"start1":7412,"start2":7412,"length1":14,"length2":17}]],"length":7429,"saved":false}
{"ts":1351541683890,"patch":[[{"diffs":[[0,"owerCase"],[1,"() "],[0,"\n    }"]],"start1":7415,"start2":7415,"length1":14,"length2":17}]],"length":7432,"saved":false}
{"ts":1351541684866,"patch":[[{"diffs":[[0,"rCase() "],[1,"= "],[0,"\n    }"]],"start1":7418,"start2":7418,"length1":14,"length2":16}]],"length":7434,"saved":false}
{"ts":1351541685923,"patch":[[{"diffs":[[0,"Case() ="],[-1," "],[1,"=="],[0,"\n    }"]],"start1":7419,"start2":7419,"length1":15,"length2":16}]],"length":7435,"saved":false}
{"ts":1351541687251,"patch":[[{"diffs":[[0,"se() ==="],[1," "],[0,"\n    }"]],"start1":7421,"start2":7421,"length1":14,"length2":15}]],"length":7436,"saved":false}
{"ts":1351541689514,"patch":[[{"diffs":[[0,"e() === "],[1,"\""],[0,"\n    }"]],"start1":7422,"start2":7422,"length1":14,"length2":15}]],"length":7437,"saved":false}
{"ts":1351541691378,"patch":[[{"diffs":[[0,"() === \""],[1,"false"],[0,"\n    }"]],"start1":7423,"start2":7423,"length1":14,"length2":19}]],"length":7442,"saved":false}
{"ts":1351541693045,"patch":[[{"diffs":[[0,") === \"false"],[1,"\")"],[0,"\n    }"]],"start1":7424,"start2":7424,"length1":18,"length2":20}]],"length":7444,"saved":false}
{"ts":1351541695165,"patch":[[{"diffs":[[0,"\"false\")"],[1,"{\n        }"],[0,"\n    }"]],"start1":7430,"start2":7430,"length1":14,"length2":25}]],"length":7455,"saved":false}
{"ts":1351541696327,"patch":[[{"diffs":[[0,"= \"false\"){\n"],[1,"            \n"],[0,"        }\n  "]],"start1":7428,"start2":7428,"length1":24,"length2":37}]],"length":7468,"saved":false}
{"ts":1351541707651,"patch":[[{"diffs":[[0,"\"false\")"],[1,")"],[0,"{\n      "]],"start1":7430,"start2":7430,"length1":16,"length2":17}]],"length":7469,"saved":false}
{"ts":1351541708909,"patch":[[{"diffs":[[0,"\"false\")"],[-1,")"],[0,"{\n      "]],"start1":7430,"start2":7430,"length1":17,"length2":16}]],"length":7468,"saved":false}
{"ts":1351541713023,"patch":[[{"diffs":[[0,"   \n    "],[1,"var "],[0,"getLegen"]],"start1":7366,"start2":7366,"length1":16,"length2":20}]],"length":7472,"saved":false}
{"ts":1351541717858,"patch":[[{"diffs":[[0,"ndConfig"],[1," = "],[0,"(str){\n "]],"start1":7385,"start2":7385,"length1":16,"length2":19}]],"length":7475,"saved":false}
{"ts":1351541719421,"patch":[[{"diffs":[[0,"onfig = "],[1,"func"],[0,"(str){\n "]],"start1":7388,"start2":7388,"length1":16,"length2":20}]],"length":7479,"saved":false}
{"ts":1351541720621,"patch":[[{"diffs":[[0,"g = func"],[1,"tion"],[0,"(str){\n "]],"start1":7392,"start2":7392,"length1":16,"length2":20}]],"length":7483,"saved":false}
{"ts":1351541768826,"patch":[[{"diffs":[[0,"            "],[1,"\""],[0,"\n        }\n "]],"start1":7455,"start2":7455,"length1":24,"length2":25}]],"length":7484,"saved":false}
{"ts":1351541772423,"patch":[[{"diffs":[[0,"        "],[-1,"\""],[1,"ret"],[0,"\n       "]],"start1":7459,"start2":7459,"length1":17,"length2":19}]],"length":7486,"saved":false}
{"ts":1351541773566,"patch":[[{"diffs":[[0,"     ret"],[1,"urn"],[0,"\n       "]],"start1":7462,"start2":7462,"length1":16,"length2":19}]],"length":7489,"saved":false}
{"ts":1351541775867,"patch":[[{"diffs":[[0,"  return"],[1," false"],[0,"\n       "]],"start1":7465,"start2":7465,"length1":16,"length2":22}]],"length":7495,"saved":false}
{"ts":1351541781259,"patch":[[{"diffs":[[0,"return false"],[1,";"],[0,"\n        }\n "]],"start1":7467,"start2":7467,"length1":24,"length2":25}]],"length":7496,"saved":false}
{"ts":1351541784199,"patch":[[{"diffs":[[0,";\n        }\n"],[1,"        else\n"],[0,"    }"]],"start1":7479,"start2":7479,"length1":17,"length2":30}]],"length":7509,"saved":false}
{"ts":1351541785712,"patch":[[{"diffs":[[0,"    else"],[1,"{\n        }"],[0,"\n    }"]],"start1":7495,"start2":7495,"length1":14,"length2":25}]],"length":7520,"saved":false}
{"ts":1351541786968,"patch":[[{"diffs":[[0,"}\n        else{\n"],[1,"            \n"],[0,"        }\n    }"]],"start1":7489,"start2":7489,"length1":31,"length2":44}]],"length":7533,"saved":false}
{"ts":1351541788766,"patch":[[{"diffs":[[0,"            "],[1,"return "],[0,"\n        }\n "]],"start1":7505,"start2":7505,"length1":24,"length2":31}]],"length":7540,"saved":false}
{"ts":1351541790196,"patch":[[{"diffs":[[0," return "],[1,"true;"],[0,"\n       "]],"start1":7516,"start2":7516,"length1":16,"length2":21}]],"length":7545,"saved":false}
{"ts":1351541790618,"patch":[[{"diffs":[[0,"    });\n"],[-1,"    "],[0,"\n    var"]],"start1":7357,"start2":7357,"length1":20,"length2":16}]],"length":7541,"saved":false}
{"ts":1351542571597,"patch":[[{"diffs":[[0,"end) == "],[-1,"false"],[1,"\""],[0,"){\n    \t"]],"start1":2077,"start2":2077,"length1":21,"length2":17}]],"length":7537,"saved":false}
{"ts":1351542573267,"patch":[[{"diffs":[[0,"nd) == \""],[1,"false"],[0,"){\n    \t"]],"start1":2078,"start2":2078,"length1":16,"length2":21}]],"length":7542,"saved":false}
{"ts":1351542574031,"patch":[[{"diffs":[[0,"= \"false"],[1,"\""],[0,"){\n    \t"]],"start1":2083,"start2":2083,"length1":16,"length2":17}]],"length":7543,"saved":false}
{"ts":1351542577320,"patch":[[{"diffs":[[0,"gend) =="],[1,"="],[0," \"false\""]],"start1":2076,"start2":2076,"length1":16,"length2":17}]],"length":7544,"saved":false}
{"ts":1351542586156,"patch":[[{"diffs":[[0," return "],[1,"\""],[0,"false"],[1,"\""],[0,";\n      "]],"start1":7465,"start2":7465,"length1":21,"length2":23},{"diffs":[[0," return "],[1,"\""],[0,"true"],[1,"\""],[0,";\n      "]],"start1":7517,"start2":7517,"length1":20,"length2":22},{"diffs":[[0,"     }\n    }"],[1,";"]],"start1":7536,"start2":7536,"length1":12,"length2":13}]],"length":7549,"saved":false}
{"ts":1351542879058,"patch":[[{"diffs":[[0,"apsKey;\n       }"],[1,"\n       \n       (configOptions.legend)"],[0,"\n\n       if (get"]],"start1":2015,"start2":2015,"length1":32,"length2":70}]],"length":7587,"saved":false}
{"ts":1351542884713,"patch":[[{"diffs":[[0,"\n       "],[1,"console"],[0,"(configO"]],"start1":2039,"start2":2039,"length1":16,"length2":23}]],"length":7594,"saved":false}
{"ts":1351542885867,"patch":[[{"diffs":[[0," console"],[1,"."],[0,"(configO"]],"start1":2046,"start2":2046,"length1":16,"length2":17}]],"length":7595,"saved":false}
{"ts":1351542887205,"patch":[[{"diffs":[[0,"console."],[1,"log"],[0,"(configO"]],"start1":2047,"start2":2047,"length1":16,"length2":19}]],"length":7598,"saved":false}
{"ts":1351542887693,"patch":[[{"diffs":[[0,"      }\n"],[-1,"       "],[0,"\n       "]],"start1":2024,"start2":2024,"length1":23,"length2":16}]],"length":7591,"saved":false}
{"ts":1351542982852,"patch":[[{"diffs":[[0,"legend) === "],[-1,"\""],[0,"false\"){\n   "]],"start1":2116,"start2":2116,"length1":25,"length2":24}]],"length":7590,"saved":false}
{"ts":1351542984110,"patch":[[{"diffs":[[0,"d) === false"],[-1,"\""],[0,"){\n    \t   $"]],"start1":2121,"start2":2121,"length1":25,"length2":24}]],"length":7589,"saved":false}
{"ts":1351542989592,"patch":[[{"diffs":[[0," });"],[-1,"\n\n    var getLegendConfig = function(str){\n        if (str.toLowerCase() === \"false\"){\n            return \"false\";\n        }\n        else{\n            return \"true\";\n        }\n    };"]],"start1":7403,"start2":7403,"length1":186,"length2":4}]],"length":7407,"saved":false}
{"ts":1351543029908,"patch":[[{"diffs":[[0," if "],[-1,"(getLegendConfig"],[0,"(con"]],"start1":2081,"start2":2081,"length1":24,"length2":8}]],"length":7391,"saved":false}
{"ts":1351543031616,"patch":[[{"diffs":[[0,"s.legend"],[-1,")"],[0," === fal"]],"start1":2098,"start2":2098,"length1":17,"length2":16}]],"length":7390,"saved":false}
{"ts":1351543077403,"patch":[[{"diffs":[[0,".legend === "],[1,"\""],[0,"false){\n    "]],"start1":2099,"start2":2099,"length1":24,"length2":25}]],"length":7391,"saved":false}
{"ts":1351543078938,"patch":[[{"diffs":[[0,"= \"false"],[1,"\""],[0,"){\n    \t"]],"start1":2109,"start2":2109,"length1":16,"length2":17}]],"length":7392,"saved":false}
{"ts":1351543110634,"patch":[[{"diffs":[[0,"ebmap;\n       }\n"],[1,"       if(urlObject.query.legend){\n         configOptions.legend = urlObject.query.legend;\n       }\n"],[0,"       if(urlObj"]],"start1":1901,"start2":1901,"length1":32,"length2":132}]],"length":7492,"saved":false}
{"ts":1351543123162,"patch":[[{"diffs":[[0,"egend =="],[-1,"= \""],[1," "],[0,"false\"){"]],"start1":2201,"start2":2201,"length1":19,"length2":17}]],"length":7490,"saved":false}
{"ts":1351543125410,"patch":[[{"diffs":[[0,"== false"],[-1,"\""],[0,"){\n    \t"]],"start1":2207,"start2":2207,"length1":17,"length2":16}]],"length":7489,"saved":false}
{"ts":1351543133919,"patch":[[{"diffs":[[0,"egend =="],[-1," "],[1,"="],[0,"false"],[1,"\""],[0,"){\n    \t"]],"start1":2201,"start2":2201,"length1":22,"length2":23}]],"length":7490,"saved":false}
{"ts":1351543134701,"patch":[[{"diffs":[[0,"gend ==="],[1," "],[0,"false\"){"]],"start1":2202,"start2":2202,"length1":16,"length2":17}]],"length":7491,"saved":false}
{"ts":1351543135707,"patch":[[{"diffs":[[0,".legend === "],[1,"\""],[0,"false\"){\n   "]],"start1":2199,"start2":2199,"length1":24,"length2":25}]],"length":7492,"saved":false}
{"ts":1351543136493,"patch":[[{"diffs":[[0,"  }\n"],[-1,"       if(urlObject.query.legend){\n         configOptions.legend = urlObject.query.legend;\n       }\n"],[0,"    "]],"start1":1913,"start2":1913,"length1":108,"length2":8}]],"length":7392,"saved":false}
{"ts":1351543137900,"patch":[[{"diffs":[[0,"ebmap;\n       }\n"],[1,"       if(urlObject.query.legend){\n         configOptions.legend = urlObject.query.legend;\n       }\n"],[0,"       if(urlObj"]],"start1":1901,"start2":1901,"length1":32,"length2":132}]],"length":7492,"saved":false}
{"ts":1351543139513,"patch":[[{"diffs":[[0,"gend ==="],[-1," \""],[0,"false\"){"]],"start1":2202,"start2":2202,"length1":18,"length2":16}]],"length":7490,"saved":false}
{"ts":1351543140145,"patch":[[{"diffs":[[0,"egend =="],[-1,"="],[0,"false\"){"]],"start1":2201,"start2":2201,"length1":17,"length2":16}]],"length":7489,"saved":false}
{"ts":1351543141206,"patch":[[{"diffs":[[0,"egend =="],[1,"= \""],[0,"false\"){"]],"start1":2201,"start2":2201,"length1":16,"length2":19}]],"length":7492,"saved":false}
{"contributors":[],"silentsave":false,"ts":1352134650291,"patch":[[{"diffs":[[0," \"false\""],[1," || configOptions.legend === false"],[0,"){\n"],[-1,""],[0,"    \t   "]],"start1":2210,"start2":2210,"length1":19,"length2":53},{"diffs":[[0," }\n       else{\n"],[1,""],[0,"         $(\"#leg"]],"start1":4071,"start2":4071,"length1":32,"length2":32},{"diffs":[[0," });"],[-1,"  dojo.require(\"esri.map\");\n  dojo.require(\"esri.dijit.Legend\");\n  dojo.require(\"esri.dijit.Scalebar\");\n  dojo.require(\"esri.arcgis.utils\");\n  dojo.require(\"esri.IdentityManager\");\n  dojo.require(\"dijit.dijit\");\n  dojo.require(\"dijit.layout.BorderContainer\");\n  dojo.require(\"dijit.layout.ContentPane\");\n  dojo.require(\"dijit.layout.StackContainer\");\n  dojo.requireLocalization(\"esriTemplate\",\"template\");\n\n\n     var map, urlObjects, i18n;\n\n\t function initMap() {\n       patchID();\n\n\t   //get the localization strings\n  \t   i18n = dojo.i18n.getLocalization(\"esriTemplate\",\"template\");\n\n\t   dojo.byId('loading').innerHTML = i18n.viewer.loading.message;\n\t   dojo.byId('legTogText').innerHTML = i18n.viewer.legToggle.down;\n\n       if(configOptions.geometryserviceurl && location.protocol === \"https:\"){\n         configOptions.geometryserviceurl = configOptions.geometryserviceurl.replace('http:','https:');\n       }\n       esri.config.defaults.geometryService = new esri.tasks.GeometryService(configOptions.geometryserviceurl);\n\n       if(!configOptions.sharingurl){\n         configOptions.sharingurl = location.protocol + '//' + location.host + \"/sharing/content/items\";\n       }\n       esri.arcgis.utils.arcgisUrl = configOptions.sharingurl;\n\n       if(!configOptions.proxyurl){\n         configOptions.proxyurl = location.protocol + '//' + location.host + \"/sharing/proxy\";\n       }\n\n       esri.config.defaults.io.proxyUrl =  configOptions.proxyurl;\n\n       esri.config.defaults.io.alwaysUseProxy = false;\n\n       urlObject = esri.urlToObject(document.location.href);\n       urlObject.query = urlObject.query || {};\n\n       if(urlObject.query.title){\n         configOptions.title = urlObject.query.title;\n       }\n       if(urlObject.query.subtitle){\n         configOptions.title = urlObject.query.subtitle;\n       }\n       if(urlObject.query.webmap){\n         configOptions.webmap = urlObject.query.webmap;\n       }\n       if(urlObject.query.bingMapsKey){\n         configOptions.bingmapskey = urlObject.query.bingMapsKey;\n       }\n\n\t   var mapDeferred = esri.arcgis.utils.createMap(configOptions.webmap, \"map\", {\n         mapOptions: {\n           slider: true,\n           nav: false,\n           wrapAround180:true\n         },\n         ignorePopups:false,\n         bingMapsKey: configOptions.bingmapskey\n       });\n\n       mapDeferred.addCallback(function (response) {\n\n\t\t document.title = configOptions.title|| response.itemInfo.item.title || \"\";\n         dojo.byId(\"title\").innerHTML = configOptions.title ||response.itemInfo.item.title || \"\";\n         dojo.byId(\"subtitle\").innerHTML = configOptions.subtitle|| response.itemInfo.item.snippet || \"\";\n\n         map = response.map;\n\n\t\t dojo.connect(map,\"onUpdateEnd\",hideLoader);\n\n         var layers = response.itemInfo.itemData.operationalLayers;\n         if(map.loaded){\n           initUI(layers);\n         }\n         else{\n           dojo.connect(map,\"onLoad\",function(){\n             initUI(layers);\n           });\n         }\n         //resize the map when the browser resizes\n         dojo.connect(dijit.byId('map'), 'resize', map,map.resize);\n       });\n\n       mapDeferred.addErrback(function (error) {\n         alert(i18n.viewer.errors.createMap + dojo.toJson(error.message));\n       });\n\n     }\n\n\n     function initUI(layers) {\n       //add chrome theme for popup\n       dojo.addClass(map.infoWindow.domNode, \"chrome\");\n       //add the scalebar\n       var scalebar = new esri.dijit.Scalebar({\n         map: map,\n         scalebarUnit:i18n.viewer.main.scaleBarUnits //metric or english\n       });\n\n       var layerInfo = buildLayersList(layers);\n\n       if(layerInfo.length > 0){\n         var legendDijit = new esri.dijit.Legend({\n           map:map,\n           layerInfos:layerInfo\n         },\"legendDiv\");\n         legendDijit.startup();\n       }\n       else{\n         dojo.byId('legendDiv').innerHTML = \"\";\n       }\n     }\n\n//build a list of layers to dispaly in the legend\n  function buildLayersList(layers){\n\n //layers  arg is  response.itemInfo.itemData.operationalLayers;\n  var layerInfos = [];\n  dojo.forEach(layers, function (mapLayer, index) {\n      var layerInfo = {};\n      if (mapLayer.featureCollection && mapLayer.type !== \"CSV\") {\n        if (mapLayer.featureCollection.showLegend === true) {\n            dojo.forEach(mapLayer.featureCollection.layers, function (fcMapLayer) {\n              if (fcMapLayer.showLegend !== false) {\n                  layerInfo = {\n                      \"layer\": fcMapLayer.layerObject,\n                      \"title\": mapLayer.title,\n                      \"defaultSymbol\": false\n                  };\n                  if (mapLayer.featureCollection.layers.length > 1) {\n                      layerInfo.title += \" - \" + fcMapLayer.layerDefinition.name;\n                  }\n                  layerInfos.push(layerInfo);\n              }\n            });\n          }\n      } else if (mapLayer.showLegend !== false && mapLayer.layerObject) {\n      var showDefaultSymbol = false;\n      if (mapLayer.layerObject.version < 10.1 && (mapLayer.layerObject instanceof esri.layers.ArcGISDynamicMapServiceLayer || mapLayer.layerObject instanceof esri.layers.ArcGISTiledMapServiceLayer)) {\n        showDefaultSymbol = true;\n      }\n      layerInfo = {\n        \"layer\": mapLayer.layerObject,\n        \"title\": mapLayer.title,\n        \"defaultSymbol\": showDefaultSymbol\n      };\n        //does it have layers too? If so check to see if showLegend is false\n        if (mapLayer.layers) {\n            var hideLayers = dojo.map(dojo.filter(mapLayer.layers, function (lyr) {\n                return (lyr.showLegend === false);\n            }), function (lyr) {\n                return lyr.id;\n            });\n            if (hideLayers.length) {\n                layerInfo.hideLayers = hideLayers;\n            }\n        }\n        layerInfos.push(layerInfo);\n    }\n  });\n  return layerInfos;\n  }\n\n\n     function patchID() {  //patch id manager for use in apps.arcgis.com\n       esri.id._isIdProvider = function(server, resource) {\n       // server and resource are assumed one of portal domains\n\n       var i = -1, j = -1;\n\n       dojo.forEach(this._gwDomains, function(domain, idx) {\n         if (i === -1 && domain.regex.test(server)) {\n           i = idx;\n         }\n         if (j === -1 && domain.regex.test(resource)) {\n           j = idx;\n         }\n       });\n\n       var retVal = false;\n\n       if (i > -1 && j > -1) {\n         if (i === 0 || i === 4) {\n           if (j === 0 || j === 4) {\n             retVal = true;\n           }\n         }\n         else if (i === 1) {\n           if (j === 1 || j === 2) {\n             retVal = true;\n           }\n         }\n         else if (i === 2) {\n           if (j === 2) {\n             retVal = true;\n           }\n         }\n         else if (i === 3) {\n           if (j === 3) {\n             retVal = true;\n           }\n         }\n       }\n\n       return retVal;\n     };\n    }\n\n\tfunction hideLoader(){\n\t  $(\"#loadingCon\").hide();\n\t}\n\n\t//Jquery Layout\n\t$(document).ready(function(e) {\n\t  $(\"#legendToggle\").click(function(){\n\t\tif ($(\"#legendDiv\").css('display')=='none'){\n\t\t  $(\"#legTogText\").html(i18n.viewer.legToggle.up);\n\t\t}\n\t\telse{\n\t\t  $(\"#legTogText\").html(i18n.viewer.legToggle.down);\n\t\t}\n\t\t$(\"#legendDiv\").slideToggle();\n\t  });\n    });"]],"start1":7522,"start2":7522,"length1":7277,"length2":4}]],"length":7526,"saved":false}
{"ts":1352134689006,"patch":[[{"diffs":[[0,"  \t   $(\"#legend"],[-1,"Toggle"],[1,"Con"],[0,"\").hide();\n\t   }"]],"start1":2257,"start2":2257,"length1":38,"length2":35}]],"length":7523,"saved":false}
